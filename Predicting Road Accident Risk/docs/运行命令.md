# Road Accident Risk Prediction 运行命令

## 文件说明

已创建完整的 Python 脚本：`road_accident_risk_complete.py`

该脚本整合了 notebook 中的所有代码，并已修改为支持本地运行。

## 环境要求

### 1. Python 依赖

```bash
# 安装基础依赖
python3 -m pip install pandas numpy scikit-learn

# 安装 pytabkit（TabM 模型库）
python3 -m pip install pytabkit

# 如果需要 GPU 支持
pip install torch
```

### 2. 数据目录

确保 `playground-series-s5e10` 目录存在并包含以下文件：
- `train.csv` - 训练数据（必需）
- `test.csv` - 测试数据（必需）
- `synthetic_road_accidents_100k.csv` - 原始数据（可选，用于特征工程）

## 运行命令

### 1. 基本运行

```bash
python3 road_accident_risk_complete.py
```

### 2. 指定数据目录

```bash
python3 road_accident_risk_complete.py --data-dir ./playground-series-s5e10
```

### 3. 指定输出目录

```bash
python3 road_accident_risk_complete.py --output-dir ./my_output
```

### 4. 跳过依赖安装

```bash
python3 road_accident_risk_complete.py --skip-install
```

### 5. 完整参数示例

```bash
python3 road_accident_risk_complete.py \
    --data-dir ./playground-series-s5e10 \
    --output-dir ./output \
    --skip-install
```

## 输出文件

运行完成后，会在输出目录（默认 `./output`）生成：

- `oof_tabm_plus_origcol_tuned.csv` - Out-of-Fold 预测结果（用于验证）
- `test_tabm_plus_origcol_tuned.csv` - 测试集预测结果（用于提交）

## 注意事项

1. **原始数据文件**：如果 `synthetic_road_accidents_100k.csv` 不存在，脚本会自动跳过基于原始数据的特征工程，但仍会使用其他特征。

2. **GPU 支持**：TabM 模型支持 GPU 加速，如果检测到 CUDA，会自动使用 GPU。

3. **训练时间**：5 折交叉验证训练可能需要较长时间（取决于硬件配置）。

4. **内存使用**：确保有足够的内存（建议至少 8GB RAM）。

## 故障排除

### 依赖安装问题

如果遇到依赖安装问题：

```bash
# 使用 conda 环境
conda create -n road_accident python=3.9
conda activate road_accident
pip install pytabkit pandas numpy scikit-learn
```

### 数据文件不存在

如果原始数据文件不存在，脚本会显示警告但继续执行：

```
警告: 原始数据文件不存在 (./playground-series-s5e10/synthetic_road_accidents_100k.csv)，将跳过基于原始数据的特征工程
```

### CUDA 错误

如果遇到 CUDA 相关错误，可以强制使用 CPU：

```python
# 在脚本中设置环境变量
import os
os.environ['CUDA_VISIBLE_DEVICES'] = ''
```

## 示例输出

```
============================================================
Environment Information:
============================================================
python_version: 3.9.6
platform: Darwin
pytorch_version: 2.0.0
cuda_available: False
cuda_device_count: 0
============================================================

*** Installing/checking dependencies...
  ✓ pytabkit already installed

*** 开始执行训练和预测...
*** 数据目录: ./playground-series-s5e10
*** 输出目录: ./output

Train Shape: (517754, 14)
Test Shape: (172585, 13)
...
--- Fold 1/5 ---
Fold 1 RMSE: 0.05606
...
Overall OOF RMSE: 0.05590

*** 预测结果已保存到 ./output/ 目录
```

