# 常见错误解决方案

## 错误 0: zsh: command not found: pip

### 问题描述
运行 notebook 时出现 `zsh:1: command not found: pip` 错误。

### 原因
系统中没有 `pip` 命令，但可能有 `pip3` 或需要通过 `python3 -m pip` 调用。

### 解决方案

**方法 1: 使用 python3 -m pip（推荐，已修复）**

✅ **已修复**：notebook 中的 `!pip` 已改为 `!python3 -m pip`，这样可以在所有系统上工作。

**方法 2: 在终端中安装依赖**

如果仍然遇到问题，可以在终端中手动安装：

```bash
# 使用 pip3
pip3 install numpy tqdm tokenizers

# 或使用 python3 -m pip
python3 -m pip install numpy tqdm tokenizers
```

**方法 3: 创建 pip 别名**

在 `~/.zshrc` 中添加：
```bash
alias pip='pip3'
alias python='python3'
```
然后运行 `source ~/.zshrc`

## 错误 0.5: ModuleNotFoundError: No module named 'unsloth'

### 问题描述
运行 notebook 时出现 `ModuleNotFoundError: No module named 'unsloth'` 错误。

### 解决方案

**快速修复（在终端中）**：
```bash
cd "/Users/yuanrui/go/src/new/kaggle study/ARC Prize 2024"
python3 -m pip install --upgrade pip
python3 -m pip install torch torchvision torchaudio
python3 -m pip install transformers datasets accelerate peft trl
python3 -m pip install unsloth
```

**在 Notebook 中安装**：
在 Cell 7 之前创建新单元格：
```python
!python3 -m pip install torch torchvision torchaudio transformers datasets accelerate peft trl unsloth
```

**验证安装**：
```python
from unsloth import FastLanguageModel
print("Unsloth installed successfully")
```

详细说明见 `安装依赖.md` 和 `快速修复-unsloth安装.md`

## 错误 1: ModuleNotFoundError: No module named 'numpy'

### 问题描述
运行 notebook 时出现 `ModuleNotFoundError: No module named 'numpy'` 错误。

### 解决方案

**方法 1: 在 notebook 中安装（推荐）**

在运行 Cell 7 之前，先运行以下代码安装基础依赖：

```python
# 在 Jupyter Notebook 中运行
!pip install numpy tqdm tokenizers
```

或者使用 `%pip`（推荐）：
```python
%pip install numpy tqdm tokenizers
```

**方法 2: 在终端中安装**

在运行 notebook 之前，在终端中执行：

```bash
pip install numpy tqdm tokenizers
```

**方法 3: 安装所有依赖**

```bash
pip install numpy tqdm tokenizers transformers datasets accelerate peft trl unsloth torch
```

## 错误 2: 缺少 os 或 numpy 导入

### 问题描述
`common_stuff.py` 中使用了 `os` 和 `numpy` 但没有导入。

### 解决方案

✅ **已修复**：notebook 的 Cell 6 已经更新，包含了正确的导入：
```python
import os
import numpy as np
```

如果仍然遇到问题，请重新运行 Cell 6 以重新生成 `common_stuff.py`。

## 错误 3: 文件路径不存在

### 问题描述
找不到 JSON 数据文件。

### 解决方案

1. 确保 `arc-prize-2024/` 目录与 notebook 在同一目录下
2. 检查文件是否存在：
   ```python
   import os
   print(os.path.exists('./arc-prize-2024/arc-agi_test_challenges.json'))
   ```
3. 如果文件不存在，请从 Kaggle 下载数据文件

## 错误 4: CUDA out of memory

### 问题描述
GPU 内存不足。

### 解决方案

1. **减少 batch size**：在 `common_stuff.py` 中修改：
   ```python
   per_device_train_batch_size=1  # 从 2 改为 1
   gradient_accumulation_steps=4  # 从 2 改为 4
   ```

2. **使用 CPU**（不推荐，会很慢）：
   - 修改 `prepare_model` 中的 `device_map='cpu'`

3. **使用更小的模型**：
   - 修改 `base_model` 为更小的模型

## 错误 5: 模型下载失败

### 问题描述
无法从 Hugging Face 下载模型。

### 解决方案

1. **检查网络连接**：确保可以访问 Hugging Face
2. **使用本地模型**：如果已下载模型，修改路径：
   ```python
   base_model = './path/to/local/model'
   ```
3. **设置 Hugging Face token**（如果需要）：
   ```python
   from huggingface_hub import login
   login(token='your_token')
   ```

## 错误 6: Unsloth 安装失败

### 问题描述
无法安装 unsloth 库。

### 解决方案

1. **更新 pip**：
   ```bash
   pip install --upgrade pip
   ```

2. **安装依赖**：
   ```bash
   pip install torch torchvision torchaudio
   pip install unsloth
   ```

3. **如果仍然失败**，尝试从源码安装：
   ```bash
   pip install git+https://github.com/unslothai/unsloth.git
   ```

## 推荐的运行顺序

1. **安装基础依赖**（在终端或 notebook 中）：
   ```bash
   pip install numpy tqdm tokenizers
   ```

2. **运行 Cell 0-6**：生成所有必要的 Python 文件

3. **运行 Cell 7**：安装 unsloth 和其他依赖

4. **运行后续单元格**：开始训练和推理

## 检查清单

在运行 notebook 之前，确保：

- [ ] Python 3.10+ 已安装
- [ ] 基础依赖已安装（numpy, tqdm, tokenizers）
- [ ] 数据文件在正确位置（`./arc-prize-2024/`）
- [ ] 有足够的 GPU 内存（推荐 16GB+）
- [ ] 网络连接正常（用于下载模型）

