# ARC Prize 2024 解决方案运行指南

这是一个 Kaggle 竞赛的获胜解决方案，用于解决 ARC (Abstraction and Reasoning Corpus) 挑战。

## 运行方式

### 方式 1: 在 Kaggle 上运行（推荐）

这个 notebook 是为 Kaggle 环境设计的，最佳运行方式是在 Kaggle 平台上：

1. **上传到 Kaggle**:
   - 登录 [Kaggle](https://www.kaggle.com/)
   - 创建新的 Notebook
   - 上传 `arc-prize-2024-solution-by-the-architects.ipynb`

2. **添加数据集**:
   - 添加竞赛数据集: `arc-prize-2024`
   - 添加模型数据集: `wb55l-nemomini-fulleval`
   - 添加 Unsloth 数据集: `unsloth-2024-9-post4`

3. **启用 GPU**:
   - 在 Notebook 设置中启用 GPU (推荐 Tesla T4 或更高)

4. **运行**:
   - 点击 "Run All" 运行所有单元格

### 方式 2: 在本地运行（已修改路径）

**✅ 路径已修改完成！** Notebook 中的 Kaggle 路径已改为本地路径。

#### 前置要求

1. **Python 环境**: Python 3.10
2. **GPU**: 需要 NVIDIA GPU 和 CUDA 支持
3. **依赖库**:
   ```bash
   pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
   pip install transformers datasets accelerate peft trl
   pip install unsloth
   pip install tokenizers tqdm numpy
   ```

#### 已完成的修改

1. **✅ 路径配置已修改**:
   - `tmp_dir`: `/kaggle/temp` → `./temp`
   - `arc_challenge_file`: `/kaggle/input/arc-prize-2024/...` → `./arc-prize-2024/...`
   - `arc_solutions_file`: `/kaggle/input/arc-prize-2024/...` → `./arc-prize-2024/...`
   - `base_model`: `/kaggle/input/wb55l_nemomini_fulleval/...` → `wb55l_nemomini_fulleval` (将自动从 Hugging Face 下载)

2. **✅ Unsloth 安装已修改**:
   - 从离线安装改为在线安装: `!pip install unsloth`

#### 准备步骤

1. **准备数据文件**:
   - 确保 `arc-prize-2024/` 目录下有所有必需的 JSON 文件
   - 文件应位于 notebook 同级目录下

2. **模型会自动下载**:
   - `base_model` 已设置为 `'wb55l_nemomini_fulleval'`
   - 首次运行时会自动从 Hugging Face 下载模型（需要网络连接）
   - 如果模型已下载，可以设置为本地路径

#### 运行步骤

**重要：在运行 notebook 之前，请先安装基础依赖！**

1. **安装基础依赖**（在终端中）：
   ```bash
   pip install numpy tqdm tokenizers
   ```

2. **运行 notebook**：
   ```bash
   # 方式 A: 使用 Jupyter Notebook
   jupyter notebook arc-prize-2024-solution-by-the-architects.ipynb

   # 方式 B: 使用 JupyterLab
   jupyter lab arc-prize-2024-solution-by-the-architects.ipynb
   ```

3. **在 notebook 中按顺序运行**：
   - Cell 0-6: 生成所有 Python 文件
   - Cell 7: 安装 unsloth 和其他依赖（会自动安装基础包）
   - Cell 8+: 开始训练和推理

**注意**：
- 如果遇到 `command not found: pip` 错误，notebook 已修复为使用 `python3 -m pip`
- 如果遇到 `ModuleNotFoundError: No module named 'numpy'` 错误，请先运行：
```python
!python3 -m pip install numpy tqdm tokenizers
```

## Notebook 结构

这个 notebook 包含以下主要部分：

1. **Cell 0-1**: 版权和说明
2. **Cell 2**: 导出 `model_runner.py` - 模型运行相关函数
3. **Cell 3**: 导出 `arc_loader.py` - ARC 数据加载器
4. **Cell 4**: 导出 `selection.py` - 选择和评分算法
5. **Cell 5**: 导出 `async_tools.py` - 异步工具
6. **Cell 6**: 导出 `common_stuff.py` - 通用配置
7. **Cell 7**: 安装依赖和初始化
8. **Cell 8+**: 训练和推理执行

## 注意事项

1. **GPU 内存**: 这个解决方案需要大量 GPU 内存，建议至少 16GB
2. **运行时间**: 完整运行可能需要数小时
3. **数据路径**: 确保所有数据文件路径正确
4. **模型文件**: 需要下载大型语言模型（可能几十GB）

## 故障排除

### 问题 1: CUDA out of memory
- **解决**: 减少 batch size 或使用更小的模型

### 问题 2: 找不到数据文件
- **解决**: 检查文件路径是否正确，确保 JSON 文件存在

### 问题 3: Unsloth 安装失败
- **解决**: 尝试从源码安装或使用替代方案

### 问题 4: 模型加载失败
- **解决**: 确保模型文件完整，检查 Hugging Face 访问权限

## 相关资源

- [ARC Prize 2024 竞赛页面](https://www.kaggle.com/competitions/arc-prize-2024)
- [Unsloth 文档](https://github.com/unslothai/unsloth)
- [Hugging Face Transformers](https://huggingface.co/docs/transformers)

