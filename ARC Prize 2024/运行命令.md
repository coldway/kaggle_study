# ARC Prize 2024 运行命令

## 文件说明

已创建完整的 Python 脚本：`arc_solution_complete.py`

该脚本整合了 notebook 中的所有代码，并已修改为支持本地运行。

## 环境要求

### 1. Python 依赖

```bash
# 安装基础依赖
pip install torch torchvision torchaudio

# 安装 transformers 和相关依赖
pip install transformers accelerate bitsandbytes datasets trl peft
pip install numpy tqdm tokenizers huggingface_hub psutil
```

### 2. HuggingFace Token（如果需要访问私有模型）

```bash
# 方法1: 设置环境变量
export HF_TOKEN='your_token_here'

# 方法2: 使用 huggingface-cli
huggingface-cli login
```

### 3. 数据目录

确保 `arc-prize-2024` 目录存在并包含以下文件：
- `arc-agi_test_challenges.json`
- `arc-agi_training_solutions.json`
- `arc-agi_training_challenges.json` (可选)
- `arc-agi_evaluation_challenges.json` (可选)

## 运行命令

### 1. 完整运行（训练 + 推理 + 生成提交文件）

```bash
python3 arc_solution_complete.py --mode full
```

### 2. 仅训练

```bash
python3 arc_solution_complete.py --mode train
```

### 3. 仅推理

```bash
python3 arc_solution_complete.py --mode inference
```

### 4. 指定模型

```bash
# 使用本地模型路径
python3 arc_solution_complete.py --mode full --model ./model

# 使用 HuggingFace 模型名称
python3 arc_solution_complete.py --mode full --model microsoft/phi-2
```

### 5. 指定 GPU（如果有多个 GPU）

```bash
python3 arc_solution_complete.py --mode full --gpu 0
```

## 输出文件

- `submission.json`: 生成的提交文件
- `./temp/finetuned_model_gpu0/`: 训练后的模型
- `./temp/inference_outputs/`: 推理输出
- `./temp/inference_scoring/`: 评分结果

## 注意事项

1. **macOS/CPU 模式**: 脚本会自动检测环境，在 macOS 或没有 CUDA 的情况下使用 CPU 模式，并自动调整批次大小和优化器。

2. **模型访问**: 如果模型需要认证，请确保设置了 `HF_TOKEN` 环境变量。

3. **内存使用**: CPU 模式下训练速度较慢，建议使用较小的批次大小（已在代码中自动调整）。

4. **路径配置**: 所有路径已从 Kaggle 路径（`/kaggle/input/arc-prize-2024/`）改为本地路径（`./arc-prize-2024/`）。

## 故障排除

### 模型访问错误

如果遇到 `401 Unauthorized` 或 `RepositoryNotFoundError`:

1. 检查模型是否需要认证
2. 设置 `HF_TOKEN` 环境变量
3. 或使用替代的公开模型（修改脚本中的 `base_model` 变量）

### 内存不足

如果遇到内存错误：

1. 减小批次大小（已在 CPU 模式下自动调整）
2. 使用更小的模型
3. 减少训练轮数

### 依赖安装问题

如果遇到依赖安装问题：

```bash
# 使用 conda 环境
conda create -n arc_prize python=3.9
conda activate arc_prize
pip install -r requirements.txt  # 如果有 requirements.txt
```

## 示例输出

```
============================================================
Environment Information:
============================================================
python_version: 3.9.0
platform: Darwin
pytorch_version: 2.0.0
cuda_available: False
cuda_device_count: 0
============================================================

*** 提示: 如果模型需要认证，请设置环境变量:
***   export HF_TOKEN='your_token_here'
***   或运行: huggingface-cli login

============================================================
开始训练...
============================================================
...
```

